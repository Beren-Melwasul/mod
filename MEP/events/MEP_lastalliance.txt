#-----------------------------------------------------
# MEP : Last Alliance Events
#-----------------------------------------------------
# Global Flags:
# mep_start_lastalliance, mep_lastalliance_done1, mep_lastalliance_done2
# mep_lastalliance_offensive, mep_lastalliance_saurondefeated
# Character Flgas:
# mep_lastalliance_leader, mep_lastalliance_joined
#------------------------------------------------------------
# Events 0 to 8 : Setting up the alliance (with notifications)
# Events 10 to x : Declare war and send notifications
# Events 40 to y : Duel with Sauron/Mordor Leader, and aftermath

namespace = lastalliance
#------------------------------------------------------------
# Event 0: launched by Elendil (or the equivalent) via decision, present info and a choice to go ahead or not.
long_character_event = {
	id = lastalliance.0
	title = EVTTITlastalliance.0
	desc = EVTDESClastalliance.0
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# Send the requests to join
	option = {
		name = EVTOPTAlastalliance.0
		hidden_tooltip = {
			set_global_flag = mep_start_lastalliance
			set_variable = { which = mep_lastalliance_joined_counter value = 0 }
		}
		# The call is sent to 'good' independent rulers (except for ultra-isolationists )
		custom_tooltip = {
			text = TT_MEP_LASTALLIANCE0_SENDMESSAGE
			any_independent_ruler = {
				limit = {
					mep_is_good_side_trigger = yes
					NOT = { religion_group = religion_group_enyd }
					NOT = { culture = culture_valar }
					NOT = { culture = culture_enigma }
					higher_real_tier_than  = count
					mercenary = no
				}
				character_event = { id = lastalliance.1  days = 7 }
			}
		}
		wealth = -50
		# schedule event that will check the results of the messages
		hidden_tooltip = {
			character_event = { id = lastalliance.4  days = 30 }
		}
		
	}
	
	# I don't feel like that now...
	option = {
		trigger = { ai = no }
		name = EVTOPTBlastalliance.0
	}
	
}
#------------------------------------------------------------
# Event 1 : event sent to good side independent leaders to join last alliance or not.
character_event = {
	id = lastalliance.1
	title = EVTTITlastalliance.1
	desc = EVTDESClastalliance.1
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# yes, join
	option = {
		name = EVTOPTAlastalliance.1
		trigger = {
			is_alive = yes
			FROM = { is_alive = yes } 
		}
		# AI never joins if their opinion of the caller is less than -20
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				NOT = { opinion = { who = FROM value = -20 } }
			}
		}
		FROM = {
			character_event = { id = lastalliance.2 days = 7 }
		}

		
	}
	
	# no, don't join
	option = {
		name = EVTOPTBlastalliance.1
		trigger = {
			is_alive = yes
			FROM = { is_alive = yes } 
		}
		# AI always joins if their opinion of the caller is better than 30
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				opinion = { who = FROM value = 30 }
			}
		}
		FROM = {
			character_event = { id = lastalliance.3 days = 7 }
		}
	}
	
	# The caller has died while this message reached you
	option = {
		name = EVTOPTClastalliance.1
		trigger = {
			is_alive = yes
			FROM = { is_alive = no } 
		}
		# do nothing except clear the flag
		clr_global_flag = mep_start_lastalliance
	}
	
}
#------------------------------------------------------------
# Events 2 and 3 : Positive or negative response to Request
# Event 2 : Response, Yes, X will join!
character_event = {
	id = lastalliance.2
	title = EVTTITlastalliance.2
	desc = EVTDESClastalliance.2
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# good
	option = {
		name = EVTOPTAlastalliance.2
		trigger = { is_alive = yes } # not sure if this is necessary...
		# set up the alliance...
		FROM = {
			opinion = {
				modifier = in_non_aggression_pact
				who = ROOT
				years = 20 #Set duration
			}
			reverse_opinion = {
				modifier = in_non_aggression_pact
				who = ROOT
				years = 20 #Set duration
			}
			add_alliance = { who = ROOT years = 20 } #Set duration
			hidden_tooltip = {
				set_character_flag = mep_lastalliance_joined
			}
		}
		# perhaps add an extra opinion modifier here...
		# logging the response
		hidden_tooltip = {
			change_variable = { which = mep_lastalliance_joined_counter value = 1 }
		}
		
	}
	
	# just in case the proposer of the alliance dies...
	option = {
		name = EVTOPTBlastalliance.2
		trigger = { is_alive = no }
		# clear flags and stuff
		hidden_tooltip = {
			clr_global_flag = mep_start_lastalliance
		}
	}
	
}
#------------------------------------------------------------
# Event 3 : Response, NO, X will NOT join
character_event = {
	id = lastalliance.3
	title = EVTTITlastalliance.3
	desc = EVTDESClastalliance.3
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# Darn!
	option = {
		name = EVTOPTAlastalliance.3
		trigger = { is_alive = yes } # not sure if this is necessary...
		# perhaps add an extra opinion modifier here...
	}
	
	# just in case the propoer of the alliance dies...
	option = {
		name = EVTOPTBlastalliance.3
		trigger = { is_alive = no }
		# clear flags and stuff
		hidden_tooltip = {
			clr_global_flag = mep_start_lastalliance
		}
	}
}
#------------------------------------------------------------
# Event 4 : fires to check what the results of the requests are
character_event = {
	id = lastalliance.4
	hide_window = yes
	
	is_triggered_only = yes
	
	# calculating the effects
	immediate = {
		clr_global_flag = mep_start_lastalliance
		# you need Gil-Galad (or his successor) and 2 others for a successful alliance-forming
		if = {
			limit = {
				check_variable = { which = mep_lastalliance_joined_counter value = 3 }
				e_noldor = {
					has_holder = yes
					holder_scope = { has_character_flag = mep_lastalliance_joined }
				}
			}
			set_global_flag = mep_lastalliance_done1
		}
	}
	
	# Successful (and still alive)
	option = {
		trigger = {
			is_alive = yes
			has_global_flag = mep_lastalliance_done1
		} 
		character_event = { id = lastalliance.5 }
	}
	
	# Unsuccessful (and still alive)
	option = {
		trigger = {
			is_alive = yes
			NOT = { has_global_flag = mep_lastalliance_done1 }
		}
		# clear flags and stuff
		any_independent_ruler = {
			limit = { has_character_flag = mep_lastalliance_joined }
			clr_character_flag = mep_lastalliance_joined
			character_event = { id = lastalliance.7  days = 7 }
		}
		character_event = { id = lastalliance.6 }
	}
	
	# Dead
	option = {
		trigger = { is_alive = no }
		# clear flags and stuff
		hidden_tooltip = {
			clr_global_flag = mep_start_lastalliance
			any_independent_ruler = {
				limit = { has_character_flag = mep_lastalliance_joined }
				clr_character_flag = mep_lastalliance_joined
				character_event = { id = lastalliance.7  days = 7 }
			}
		}
	}
}

#------------------------------------------------------------
# Event 5, The 'Last Alliance' is go
character_event = {
	id = lastalliance.5
	title = EVTTITlastalliance.5
	desc = EVTDESClastalliance.5
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# Bring peace and prepare for war
	option = {
		name = EVTOPTAlastalliance.5
		# Making sure the alliance launcher (probably Elendil) and Gil-Galad/E-Noldor are still allive
		trigger = {
			is_alive = yes # not sure if this is necessary...
			e_noldor = {
				has_holder = yes
				holder_scope = {
					has_character_flag = mep_lastalliance_joined
				}
			}
		} 
		# eliminating wars among alliance members...
		custom_tooltip = {
			text = TT_MEP_LASTALLIANCE5_MAKEPEACE
			hidden_tooltip = {
				any_independent_ruler = {
					limit = { has_character_flag = mep_lastalliance_joined }
					any_independent_ruler = {
						limit = {
							has_character_flag = mep_lastalliance_joined
							NOR = {
								reverse_has_opinion_modifier = { who = PREV modifier = in_non_aggression_pact }
								has_opinion_modifier = { who = PREV modifier = in_non_aggression_pact }
							}
						}
						# we get here if the ruler has joined the alliance and does not have a non-aggression pact with PREV
						# enforcing peace if they are at war
						if = {  
							limit = { war_with = PREV }
							any_war = {
								limit = {
									OR = {
										any_attacker = { character = PREV }
										any_defender = { character = PREV }
									}
								}
								end_war = invalid
							}
						}
						# creating the non-aggression pact..
						opinion = {
							modifier = in_non_aggression_pact
							who = PREV
							years = 10 #Set duration
						}
						reverse_opinion = {
							modifier = in_non_aggression_pact
							who = PREV
							years = 10 #Set duration
						}
						# set_the_kings_peace = yes ??
					}
					character_event = { id = lastalliance.8 }
				}
			}
			
		}
		# final preps...
		hidden_tooltip = {
			clr_global_flag = mep_lastalliance_done1
			set_global_flag = mep_lastalliance_done2
			set_character_flag = mep_lastalliance_leader
		}
		

	}
	
	# just in case the propoer of the alliance, or gil-galad dies at just the wrong moment...
	option = {
		name = EVTOPTBlastalliance.5
		trigger = {
			OR = {
				is_alive = no
				e_noldor = {
					OR = {
						has_holder = no
						holder_scope = {
							NOT = { has_character_flag = mep_lastalliance_joined }
						}
					}
				}
			}
		}
		# clear flags
		hidden_tooltip = {
			clr_global_flag = mep_lastalliance_done1
			any_independent_ruler = {
				limit = { has_character_flag = mep_lastalliance_joined }
				clr_character_flag = mep_lastalliance_joined
				character_event = { id = lastalliance.7  days = 7 }
			}
		}
	}
	
}
#------------------------------------------------------------
# Event 6, The 'Last Alliance' has failed to happen
character_event = {
	id = lastalliance.6
	title = EVTTITlastalliance.6
	desc = EVTDESClastalliance.6
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# Your hopes have failed
	option = {
		name = EVTOPTAlastalliance.6
		hidden_tooltip = {
			add_character_modifier = { name = mep_lastalliance_failed  duration = 1825 }
		}
	}	
}
#------------------------------------------------------------
# Event 7 : Notification that the last alliance is aborted
character_event = {
	id = lastalliance.7
	title = EVTTITlastalliance.7
	desc = {
		trigger = { FROM = { is_alive = yes } }
		text = EVTDESClastalliance.7a
	}
	desc = {
		trigger = { FROM = { is_alive = no } }
		text = EVTDESClastalliance.7b
	}
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# Unfortunate
	option = {
		name = EVTOPTAlastalliance.7
	}
	
}
#------------------------------------------------------------
# Event 8 : Notification that the last alliance is go
character_event = {
	id = lastalliance.8
	title = EVTTITlastalliance.8
	desc = EVTDESClastalliance.8
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# Good
	option = {
		name = EVTOPTAlastalliance.8
	}
	
}
#------------------------------------------------------------
# an event is probably needed if the alliance leader dies, if e_noldor dies, or if sauron dies, before the war is started...
#======================================================================
# Event 10: launched by Elendil (or the equivalent) via decision, to start the anti-mordor war
character_event = {
	id = lastalliance.10
	title = EVTTITlastalliance.10
	desc = EVTDESClastalliance.10
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# Go ahead
	option = {
		name = EVTOPTAlastalliance.10
		e_barad_dur = {
			holder_scope = {
				reverse_war = {
					target = PREVPREV 
					casus_belli = kingdom_good_attack_evil
					thirdparty_title = k_mordor
					infamy = 0
				}
			}
		}
		hidden_tooltip = {
			set_global_flag = mep_lastalliance_offensive
			clr_global_flag = mep_lastalliance_done2
		}
		
	}
	
	# I don't feel like that now...
	option = {
		trigger = { ai = no }
		name = EVTOPTBlastalliance.10
	}
	
}
#===========================================================================
# The End of Mordor ?
#-----------------------------------
# Event 40 : Near defeat, the Dark Lord decides whether to run, or attack the Enemy leaders personally
character_event = {
	id = lastalliance.40
	title = EVTTITlastalliance.40
	desc = EVTDESClastalliance.40
	picture = GFX_evt_sauronreturns
	only_playable = yes
	war = yes
	has_global_flag = mep_lastalliance_offensive
	
	mean_time_to_happen = {
		months = 1
	}
	
	trigger = {
		always = no  # disables this for now
		has_landed_title = e_barad_dur
		# The following should ensure that loosing at 90% or more against the last alliance triggers the event
		is_primary_war_defender = yes
		any_war = {
			war_score = 90
			attacker = {
				OR = {
					has_character_flag = mep_lastalliance_leader
					has_landed_title = e_reunited_kingdom
					has_landed_title = e_gondor
				}
				war_with = PREVPREV
			}
		}
	}
	
	# I shall fight myself
	option = {
		name = EVTOPTAlastalliance.40
		trigger = {
			OR = { 
				character = 10016
				culture = culture_balrog
			}
		}
		ai_chance = { factor = 9 }
		character_event = { id = lastalliance.41 }
		log = "@@ LastAlliance.40 A"
		
	}
	
	# Time to run...
	option = {
		name = EVTOPTBlastalliance.40
		ai_chance = { factor = 1 }
		character_event = { id = lastalliance.42 }
		log = "@@ LastAlliance.40 B"
	}
	
}

# Event 41: a hidden event that sets up things for the combat 
character_event = {
	id = lastalliance.41
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		# mark the evil combatant
		save_event_target_as = mep_lastalliance_evil_combatant
		# mark good combatants
		any_war = {
			any_attacker = {
				# figure out who is going to be good combatant 1 (Human)
				# this assumes someone holding both an elven and a human kingdom is not going to happen
				if = {
					limit = { has_landed_title = e_reunited_kingdom }
					save_event_target_as = mep_lastalliance_good_combatant1
					set_character_flag = mep_lastalliance_combatant
				}
				if = {
					limit = {
						e_reunited_kingdom = { has_holder = no }
						has_landed_title = e_gondor
					}
					save_event_target_as = mep_lastalliance_good_combatant1
					set_character_flag = mep_lastalliance_combatant
				}
				if = {
					limit = {
						e_reunited_kingdom = { has_holder = no }
						e_gondor = { has_holder = no }
						has_landed_title = e_arnor
					}
					save_event_target_as = mep_lastalliance_good_combatant1
					set_character_flag = mep_lastalliance_combatant
				}
	
				# figure out who is going to be good combatant 2
				if = {
					# Gil-Galad or his successor
					limit = { has_landed_title = e_noldor }
					save_event_target_as = mep_lastalliance_good_combatant2
					set_character_flag = mep_lastalliance_combatant
					break = yes
				}
				if = {  # Durin IV or his successor
					limit = { has_landed_title = e_durins_folk }
					save_event_target_as = mep_lastalliance_good_combatant2
					set_character_flag = mep_lastalliance_combatant
					break = yes
				}
				if = {  # Amdír or Amroth or ??
					limit = { has_landed_title = k_elves }
					save_event_target_as = mep_lastalliance_good_combatant2
					set_character_flag = mep_lastalliance_combatant
					break = yes
				}
			}
		}
	}
	
	# Event dispatching
	option = {
		log = "@@ LastAlliance.41 A, [mep_lastalliance_good_combatant1.GetTitledName]"
		log = "@@ LastAlliance.41 B, [mep_lastalliance_good_combatant2.GetTitledName]"
		any_independent_ruler = {
			limit = {
				has_character_flag = mep_lastalliance_joined
				NOT = { has_character_flag = mep_lastalliance_combatant }
			}
			narrative_event = { id = lastalliance.44  days = 1 }
		}

		event_target:mep_lastalliance_good_combatant1 = {
			character_event = { id = lastalliance.46  days = 1 }
		}
		event_target:mep_lastalliance_good_combatant2 = {
			character_event = { id = lastalliance.46  days = 1 }
		}
	
		event_target:mep_lastalliance_evil_combatant = {
			character_event = { id = lastalliance.45  days = 2 }
		}
		log = "@@ LastAlliance.41 C"
		
	}
	
}

# Event 42 : hidden event when the ruler runs, dispatches the notification Event 43, and launches the destroy Mordor event
character_event = {
	id = lastalliance.42
	hide_window = yes
	
	is_triggered_only = yes

	option = {
		log = "@@ LastAlliance.42 A"
		any_independent_ruler = {
			narrative_event = { id = lastalliance.43  days = 1 }
		}
		set_character_flag = mep_lastalliance_evilrun
		character_event = { id = lastalliance.62 }
		log = "@@ LastAlliance.42 B"
	}
}

# Event 43, notification event that the Evil Overlord of Mordor has abandoned Mordor and made a run for it.
narrative_event = {
	id = lastalliance.43
	title = EVTTITlastalliance.43
	desc = EVTDESClastalliance.43
	picture = GFX_evt_sauronreturns
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTlastalliance.43
	}
}
#-----------------------------------
# Event 44, Event to last alliance leaders that The Dark Overlord (Sauron or a Balrog) is attacking personally
narrative_event = {
	id = lastalliance.44
	title = EVTTITlastalliance.44
	desc = {
		trigger = { FROM = { has_trait = balrog } }
		text = EVTDESClastalliance.44a
	}
	desc = {
		trigger = { FROM = { character = 10016 } }
		text = EVTDESClastalliance.44b
	}
	picture = GFX_evt_sauronreturns
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTlastalliance.44
	}
}
#-----------------------------------
# Event 45, Event to ruler of e_barad_dur that he (she?) is attacking
character_event = {
	id = lastalliance.45
	title = EVTTITlastalliance.45
	desc = {
		trigger = { FROM = { has_trait = balrog } }
		text = EVTDESClastalliance.45a
	}
	desc = {
		trigger = { FROM = { character = 10016 } }
		text = EVTDESClastalliance.45b
	}
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTlastalliance.45
		character_event = { id = lastalliance.47 days = 2}
	}
}
#-----------------------------------
# Event 46, You will be fighting Sauron/the Balrog, how nice!
character_event = {
	id = lastalliance.46
	title = EVTTITlastalliance.46
	desc = {
		trigger = { FROM = { has_trait = balrog } }
		text = EVTDESClastalliance.46a
	}
	desc = {
		trigger = { FROM = { character = 10016 } }
		text = EVTDESClastalliance.46b
	}
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTlastalliance.46
	}
}
#-----------------------------------
# Event 47, hidden event to decide the outcome
character_event = {
	id = lastalliance.47
	hide_window = yes
	
	is_triggered_only = yes
	
	# Event dispatching
	option = {
		# no complicated checking here!
		random_list = {
			# Outcome 1, Evil wins complete victory!
			20 = {
				event_target:mep_lastalliance_evil_combatant = {
					character_event = { id = lastalliance.48 }
				}
				event_target:mep_lastalliance_good_combatant1 = {
					character_event = { id = lastalliance.49 }
				}
				event_target:mep_lastalliance_good_combatant2 = {
					character_event = { id = lastalliance.49 }
				}
				any_independent_ruler = {
					limit = {
						has_character_flag = mep_lastalliance_joined
						NOT = { has_character_flag = mep_lastalliance_combatant }
					}
					narrative_event = { id = lastalliance.44  days = 1 }
				}
			}
			# Outcome 2 'Historical' (Evil Guy loses, both Good Guys die)
			50 = {
				event_target:mep_lastalliance_good_combatant1 = {
					character_event = { id = lastalliance.51 }
				}
				event_target:mep_lastalliance_good_combatant2 = {
					character_event = { id = lastalliance.51 }
				}
				any_independent_ruler = {
					limit = {
						has_character_flag = mep_lastalliance_joined
						NOT = { has_character_flag = mep_lastalliance_combatant }
					}
					narrative_event = { id = lastalliance.55  days = 1 }
				}
				event_target:mep_lastalliance_evil_combatant = {
					if = {
						limit = { has_trait = balrog }
						character_event = { id = lastalliance.54 }
					}
					if = {
						limit = { character = 10016 }
						character_event = { id = lastalliance.53 }
					}
					
				}
			}
			# Outcome 3, Bad Guy Looses, Good Guy 1 killed
			10 = {
				event_target:mep_lastalliance_good_combatant2 = {
					character_event = { id = lastalliance.52 }
				}
				any_independent_ruler = {
					limit = {
						has_character_flag = mep_lastalliance_joined
						NOT = { has_character_flag = mep_lastalliance_combatant }
					}
					narrative_event = { id = lastalliance.56  days = 1 }
				}
				event_target:mep_lastalliance_evil_combatant = {
					if = {
						limit = { has_trait = balrog }
						character_event = { id = lastalliance.54 }
					}
					if = {
						limit = { character = 10016 }
						character_event = { id = lastalliance.53 }
					}
				}
				event_target:mep_lastalliance_good_combatant1 = {
					character_event = { id = lastalliance.51 }
				}
			}
			# Outcome 4, Bad Guy Looses, Good Guy 2 killed
			10 = {
				event_target:mep_lastalliance_good_combatant1 = {
					character_event = { id = lastalliance.52 }
				}
				any_independent_ruler = {
					limit = {
						has_character_flag = mep_lastalliance_joined
						NOT = { has_character_flag = mep_lastalliance_combatant }
					}
					narrative_event = { id = lastalliance.57  days = 1 }
				}
				event_target:mep_lastalliance_evil_combatant = {
					if = {
						limit = { has_trait = balrog }
						character_event = { id = lastalliance.54 }
					}
					if = {
						limit = { character = 10016 }
						character_event = { id = lastalliance.53 }
					}
				}
				event_target:mep_lastalliance_good_combatant2 = {
					character_event = { id = lastalliance.51 }
				}
			}
			# Outcome 5, Evil Dies, Good Guys win
			10 = {
				event_target:mep_lastalliance_evil_combatant = {
					if = {
						limit = { has_trait = balrog }
						character_event = { id = lastalliance.60 }
					}
					if = {
						limit = { character = 10016 }
						character_event = { id = lastalliance.59 }
					}
				}
				event_target:mep_lastalliance_good_combatant1 = {
					character_event = { id = lastalliance.58 }
				}
				event_target:mep_lastalliance_good_combatant2 = {
					character_event = { id = lastalliance.58 }
				}
				any_independent_ruler = {
					limit = {
						has_character_flag = mep_lastalliance_joined
						NOT = { has_character_flag = mep_lastalliance_combatant }
					}
					narrative_event = { id = lastalliance.61  days = 1 }
				}
			}
		}

	}
	
}
#+++++++++++++++++++++++++++++++++++++++++++
## Outcome 1 Bad Guy Wins
#------------------------------------
# Event 48 Event for the bad guy that he has won!
character_event = {
	id = lastalliance.48
	title = EVTTITlastalliance.48
	desc = {
		trigger = { trait = balrog }
		text = EVTDESClastalliance.48a
	}
	desc = {
		trigger = { character = 10016 }
		text = EVTDESClastalliance.48b
	}
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	immediate = {
		# find a province to spawn troops
		any_realm_province = {
			limit = {
				NOT = {
					any_province_holding = { has_siege = yes }
				}
				
			}
			
		}
	}
	
	option = {
		name = EVTOPTlastalliance.48
		# insert commands here to:
		# generate event troops (incl troll heavy infantry army)
		# boost morale of all evil troops
		# top up garrisons and levies
		# set flags
	}
}
#------------------------------------
# Event 49 : Event to good guy participants that they have lost (and kill them)
character_event = {
	id = lastalliance.49
	title = EVTTITlastalliance.49
	desc = {
		trigger = { event_target:mep_lastalliance_evil_combatant = { trait = balrog } }
		text = EVTDESClastalliance.49a
	}
	desc = {
		trigger = { event_target:mep_lastalliance_evil_combatant = { character = 10016 } }
		text = EVTDESClastalliance.49b
	}
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTlastalliance.49
		event_target:mep_lastalliance_evil_combatant = {
			PREV = {
				any_army = {
					morale = -0.5
				}
				death = {
					death_reason = death_duel
					killer = PREV
				}
			}
		}
		
	}
}
#------------------------------------
# Event 50 : Notification to Good-Guy leaders (not participating) of the defeat.
narrative_event = {
	id = lastalliance.50
	title = EVTTITlastalliance.50
	desc = EVTDESClastalliance.50
	picture = GFX_evt_sauronreturns
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	# Oh No!
	option = {
		name = EVTOPTlastalliance.50
		any_army = {
			morale = -0.5
		}
		random = {
			chance = 50
			add_trait = depressed
		}
	}
}
#+++++++++++++++++++++++++++++++++++++++++++
## Shared events
#------------------------------------
# Event 51 : You have won, but you will not survive
character_event = {
	id = lastalliance.51
	title = EVTTITlastalliance.51
	desc = {
		trigger = { Fevent_target:mep_lastalliance_evil_combatant = { trait = balrog } }
		text = EVTDESClastalliance.51a
	}
	desc = {
		trigger = { event_target:mep_lastalliance_evil_combatant = { character = 10016 } }
		text = EVTDESClastalliance.51b
	}
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# Could be worse
	option = {
		name = EVTOPTlastalliance.51
		event_target:mep_lastalliance_evil_combatant = {
			PREV = {
				clr_character_flag = mep_lastalliance_combatant
				death = {
					death_reason = death_duel
					killer = PREV
				}
			}
		}
		
	}
}
#------------------------------------
# Event 52 : You have won, but your partner will not survive
character_event = {
	id = lastalliance.52
	title = EVTTITlastalliance.52
	desc = {
		trigger = { event_target:mep_lastalliance_evil_combatant = { trait = balrog } }
		text = EVTDESClastalliance.52a
	}
	desc = {
		trigger = { event_target:mep_lastalliance_evil_combatant = { character = 10016 } }
		text = EVTDESClastalliance.52b
	}
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# Could be worse
	option = {
		name = EVTOPTlastalliance.52
		add_trait = wounded
		clr_character_flag = mep_lastalliance_combatant
		
	}
}
#------------------------------------
# Event 53 : Sauron Loses
character_event = {
	id = lastalliance.53
	title = EVTTITlastalliance.53
	desc = EVTDESClastalliance.53
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# Damn
	option = {
		name = EVTOPTlastalliance.53
		character_event = { id = lastalliance.62 }
	}
}
#------------------------------------
# Event 54 : Balrog Loses
character_event = {
	id = lastalliance.54
	title = EVTTITlastalliance.54
	desc = EVTDESClastalliance.54
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# Damn
	option = {
		name = EVTOPTlastalliance.54
		character_event = { id = lastalliance.62 }
	}
}
#+++++++++++++++++++++++++++++++++++++++++++
## Outcome 2 : Bad Guy Loses, both Good guys killed
#------------------------------------
# Event 55 : Notification to Good-Guy leaders (not participating) of the victory.
narrative_event = {
	id = lastalliance.55
	title = EVTTITlastalliance.55
	desc = EVTDESClastalliance.55
	picture = GFX_evt_sauronreturns
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	# Good!
	option = {
		name = EVTOPTlastalliance.55
	}
}
#+++++++++++++++++++++++++++++++++++++++++++
## Outcome 3 : Bad Guy Loses, Good Guy 1 Killed
#------------------------------------
# Event 56 : Notification to Good-Guy leaders (not participating) of the victory.
narrative_event = {
	id = lastalliance.56
	title = EVTTITlastalliance.56
	desc = EVTDESClastalliance.56
	picture = GFX_evt_sauronreturns
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	# Good!
	option = {
		name = EVTOPTlastalliance.56
	}
}
#+++++++++++++++++++++++++++++++++++++++++++
## Outcome 4 : Bad Guy Loses, Good Guy 2 Killed
#------------------------------------
# Event 57 : Notification to Good-Guy leaders (not participating) of the victory.
narrative_event = {
	id = lastalliance.57
	title = EVTTITlastalliance.57
	desc = EVTDESClastalliance.57
	picture = GFX_evt_sauronreturns
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	# Good!
	option = {
		name = EVTOPTlastalliance.57
	}
}
#+++++++++++++++++++++++++++++++++++++++++++
## Outcome 5 : Bad Guy Loses, Good Guys survive
#------------------------------------
# Event 58 : You have won the fight
character_event = {
	id = lastalliance.58
	title = EVTTITlastalliance.58
	desc = {
		trigger = { event_target:mep_lastalliance_evil_combatant = { has_trait = balrog } }
		text = EVTDESClastalliance.58a
	}
	desc = {
		trigger = { event_target:mep_lastalliance_evil_combatant = { character = 10016 } }
		text = EVTDESClastalliance.58b
	}
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# Wow
	option = {
		name = EVTOPTlastalliance.58
		add_trait = wounded
		clr_character_flag = mep_lastalliance_combatant
	}
}
#------------------------------------
# Event 59 : Sauron Loses
character_event = {
	id = lastalliance.59
	title = EVTTITlastalliance.59
	desc = EVTDESClastalliance.59
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# Damn
	option = {
		name = EVTOPTlastalliance.59
		character_event = { id = lastalliance.62 }
	}
}
#------------------------------------
# Event 60 : Balrog Loses
character_event = {
	id = lastalliance.60
	title = EVTTITlastalliance.60
	desc = EVTDESClastalliance.60
	picture = GFX_evt_sauronreturns
	
	is_triggered_only = yes
	
	# Damn
	option = {
		name = EVTOPTlastalliance.60
		character_event = { id = lastalliance.62 }
	}
}
#------------------------------------
# Event 61 : Notification to Good-Guy leaders (not participating) of the victory.
narrative_event = {
	id = lastalliance.61
	title = EVTTITlastalliance.61
	desc = EVTDESClastalliance.61
	picture = GFX_evt_sauronreturns
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	# Good!
	option = {
		name = EVTOPTlastalliance.61
	}
}
#+++++++++++++++++++++++++++++++++++++++++++
# Post Outcome
#------------------------------------
# Event 62 : Massive Destroy-Mordor Event
character_event = {
	id = lastalliance.62	
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {}
	
	# Wow
	option = {
		# wreck barad-dur and morranon
		# cede occupied lands to occupiers
		# destroy vassal kingdoms
		# any remaining vassals go independent
		# destroy e_barad_dur
		# destroy duchies
		# find a courtier and dispose any remaining counties
		# decide fate of sauron/balrog/whatever		
		
	}
}
#------------------------------------
# Event 63 : What to do with the ring?
#------------------------------------
# Event 64 : What to do with Sauron if the ring is not destroyed




